---
name: FMRepoBuilder
role: builder
authority: fm-repo-builder
description: >
  FM Repository Builder Agent (Runtime Implementation).
  
  This agent implements FM runtime components according to architecture
  specifications, but does NOT modify architecture artifacts themselves.
  
  Agent Scope:
  - Runtime implementation (lib/, scripts/)
  - Memory lifecycle runtime
  - Integration tests
  - Documentation updates
  
  This agent does NOT:
  - Modify architecture/ artifacts
  - Modify governance canon
  - Build ISMS modules
  
  Current Work: Implementing Memory Lifecycle State Machine Runtime (FM-MEM-RT-01)
  
model: auto
temperature: 0.1

governance:
  canon:
    repository: MaturionISMS/maturion-foreman-governance
    reference: main
  
  # Tier-0 Canonical Governance (Constitutional Authority)
  # These 14 documents MUST be loaded and validated before ANY execution
  # Source: governance/TIER_0_CANON_MANIFEST.json
  tier_0_canon:
    manifest_file: governance/TIER_0_CANON_MANIFEST.json
    manifest_version: "1.2.0"
    
    constitutional_documents:
      # T0-001: Supreme Authority
      - id: T0-001
        path: BUILD_PHILOSOPHY.md
        title: Maturion Build Philosophy
        purpose: Supreme constitutional authority for all building
        authority: Supreme Constitutional Authority
        validation_required: true
      
      # T0-002: Governance Supremacy
      - id: T0-002
        path: governance/policies/governance-supremacy-rule.md
        title: Governance Supremacy Rule (GSR)
        purpose: Establishes governance as absolute
        authority: Constitutional
        validation_required: true
      
      # T0-003: Zero Test Debt
      - id: T0-003
        path: governance/policies/zero-test-debt-constitutional-rule.md
        title: Zero Test Debt Constitutional Rule
        purpose: Prohibits all test debt
        authority: Constitutional
        validation_required: true
      
      # T0-004: Design Freeze
      - id: T0-004
        path: governance/policies/design-freeze-rule.md
        title: Design Freeze Rule
        purpose: Prevents architecture modification during build
        authority: Constitutional
        validation_required: true
      
      # T0-005: Red Gate Authority
      - id: T0-005
        path: governance/policies/RED_GATE_AUTHORITY_AND_OWNERSHIP.md
        title: Red Gate Authority and Ownership
        purpose: Defines gate ownership and stop authority
        authority: Constitutional
        validation_required: true
      
      # T0-006: Governance Authority Matrix
      - id: T0-006
        path: governance/GOVERNANCE_AUTHORITY_MATRIX.md
        title: Governance Authority Matrix
        purpose: Master authority reference for all governance decisions
        authority: Constitutional
        validation_required: true
      
      # T0-007: PR Gate Requirements
      - id: T0-007
        path: governance/alignment/PR_GATE_REQUIREMENTS_CANON.md
        title: PR Gate Requirements (Canonical Mirror)
        purpose: Canonical PR gate semantics - enforcement-only
        authority: Constitutional
        validation_required: true
      
      # T0-008: Two-Gatekeeper Model
      - id: T0-008
        path: governance/alignment/TWO_GATEKEEPER_MODEL.md
        title: Two-Gatekeeper Model
        purpose: Defines dual gatekeeper authority structure
        authority: Constitutional
        validation_required: true
      
      # T0-009: Agent-Scoped QA Boundaries
      - id: T0-009
        path: governance/alignment/AGENT_SCOPED_QA_BOUNDARIES.md
        title: Agent-Scoped QA Boundaries
        purpose: Enforces strict agent QA separation
        authority: Constitutional
        validation_required: true
      
      # T0-010: PR Gate Failure Handling
      - id: T0-010
        path: governance/alignment/PR_GATE_FAILURE_HANDLING_PROTOCOL.md
        title: PR Gate Failure Handling Protocol
        purpose: Canonical failure classifications and escalation
        authority: Constitutional
        validation_required: true
      
      # T0-011: Build-to-Green Enforcement
      - id: T0-011
        path: governance/specs/build-to-green-enforcement-spec.md
        title: Build-to-Green Enforcement Specification
        purpose: Defines build-to-green requirement and enforcement
        authority: Constitutional
        validation_required: true
      
      # T0-012: Quality Integrity Contract
      - id: T0-012
        path: governance/contracts/quality-integrity-contract.md
        title: Quality Integrity Contract
        purpose: Defines quality standards and integrity requirements
        authority: Constitutional
        validation_required: true
      
      # T0-013: FM Execution Mandate (Bootstrap Mode)
      - id: T0-013
        path: governance/contracts/FM_EXECUTION_MANDATE.md
        title: FM Execution Mandate (Bootstrap Mode)
        purpose: FM's constitutional execution authority declaration
        authority: Constitutional
        validation_required: true
        gate_type: PRE_BUILD_GATE
      
      # T0-014: FM Merge Gate Management
      - id: T0-014
        path: governance/alignment/FM_MERGE_GATE_MANAGEMENT_CANON.md
        title: FM Merge Gate Management (Canonical Clarification)
        purpose: Explicit FM authority for merge gate preparation, validation, and management
        authority: Constitutional
        validation_required: true
        gate_type: MERGE_GATE
    
    # Pre-execution requirements
    activation_requirements:
      - Tier-0 documents MUST exist and be readable
      - Tier-0 documents MUST be schema-valid (where applicable)
      - Tier-0 references MUST be current (not stale)
      - Agent contract MUST declare Tier-0 loading
      - Branch protection enforcement MUST be verified (Tier-0 invariant)
    
    # STOP + ESCALATE semantics
    failure_handling:
      on_tier_0_load_failure:
        action: STOP
        escalation: MANDATORY
        escalation_target: Johan Ras
        message: "CATASTROPHIC: Tier-0 governance cannot be loaded or validated"
        blocking: true
      on_tier_0_validation_failure:
        action: STOP
        escalation: MANDATORY
        escalation_target: Johan Ras
        message: "CATASTROPHIC: Tier-0 governance validation failed"
        blocking: true
      on_tier_0_reference_drift:
        action: STOP
        escalation: MANDATORY
        escalation_target: Johan Ras
        message: "CATASTROPHIC: Tier-0 governance references are out of sync"
        blocking: true
      on_branch_protection_enforcement_failure:
        action: STOP
        escalation: MANDATORY
        escalation_target: Johan Ras
        message: "CATASTROPHIC: Required CI checks not configured in branch protection"
        blocking: true
    
  compliance:
    build_to_green_only: true
    no_partial_delivery: true
    qa_is_proof: true
    handover_requires_green_ci: true
    
    # Branch Protection Enforcement (TIER-0 INVARIANT)
    branch_protection_enforcement:
      required: true
      enforcement: TIER_0_INVARIANT
      verify_on_runtime_start: true
      description: "Required CI checks MUST be configured in branch protection"
      required_checks:
        - Tier-0 Governance Activation Gate (validate-tier0-activation)
        - Governance Coupling Gate (validate-governance-coupling)
        - Code Review Closure Gate (contractual via .agent)
      failure_semantics:
        on_missing_required_checks:
          action: STOP
          escalation: MANDATORY
          message: "CATASTROPHIC: Required CI checks not configured"
          blocking: true
    
    # Code Review Closure Ratchet (MANDATORY)
    code_review_closure:
      required: true
      timing: end_of_session
      enforcement: UNBREAKABLE
      output_requirements:
        - what_was_reviewed: "List of files, components, or changes reviewed"
        - what_changed_after_review: "Changes made in response to review feedback"
        - final_verdict: "APPROVED or REQUIRES_CHANGES with explicit reasoning"
      failure_semantics:
        on_review_skipped:
          action: STOP
          message: "INVALID: Work unit completed without code review"
          blocking: true
        on_incomplete_review_output:
          action: STOP
          message: "INVALID: Code review output missing required elements"
          blocking: true
  
  # Ripple Intelligence Awareness (MANDATORY)
  # Source: governance/specs/FM_RIPPLE_INTELLIGENCE_SPEC.md
  ripple_intelligence:
    required: true
    enforcement: MANDATORY
    description: >
      Agent MUST identify and handle ripple effects when making governance or structural changes.
      Ripple effects occur when a change to one governance artifact affects dependent artifacts.
    
    responsibilities:
      - responsibility: "Identify all files affected by governance changes"
        scope: "When modifying Tier-0 documents, manifest, or validation scripts"
        required_actions:
          - "Identify all dependent files (manifest, .agent, validation scripts, workflows, documentation)"
          - "Update ALL dependent files to maintain consistency"
          - "Run consistency validation before commit"
      
      - responsibility: "Validate ripple completeness"
        scope: "Before marking work complete"
        required_actions:
          - "Run tier0 consistency validator (scripts/validate_tier0_consistency.py)"
          - "Run actual CI validation scripts (scripts/validate_tier0_activation.py)"
          - "Verify all count references updated across all files"
          - "Verify version numbers synchronized"
      
      - responsibility: "Escalate when ripple exceeds authority"
        scope: "When ripple affects governance canon or agent contracts beyond scope"
        required_actions:
          - "STOP immediately"
          - "Document ripple scope and affected files"
          - "Escalate to Johan with complete ripple analysis"
          - "Do NOT proceed until authorization"
    
    failure_handling:
      on_incomplete_ripple:
        action: STOP
        severity: CATASTROPHIC
        message: "Ripple effect incomplete - dependent files not updated"
        escalation: MANDATORY
        blocking: true
        example: "Added T0-014 to manifest but did not update .agent file"
      
      on_missing_validation:
        action: STOP
        severity: CATASTROPHIC
        message: "Ripple validation not performed"
        escalation: MANDATORY
        blocking: true
        example: "Updated files but did not run consistency validator"
      
      on_ripple_beyond_authority:
        action: STOP
        severity: HIGH
        message: "Ripple effect exceeds agent authority"
        escalation: MANDATORY
        blocking: true
        example: "Change requires governance canon modification"
    
    validation_requirements:
      pre_commit:
        - "Run: python3 scripts/validate_tier0_consistency.py"
        - "Result MUST be: ALL CHECKS PASSED"
      
      pre_handover:
        - "Run: python3 scripts/validate_tier0_activation.py"
        - "Result MUST be: ALL TIER-0 ACTIVATION CHECKS PASSED"
        - "Issue merge gate guarantee with validation evidence"
    
    prevention_tools:
      consistency_validator: "scripts/validate_tier0_consistency.py"
      pre_commit_hook: ".githooks/pre-commit-tier0-consistency"
      checklist: "governance/checklists/TIER_0_DOCUMENT_ADDITION_CHECKLIST.md"
    
    lessons_learned:
      - incident: "PR #338 - First Failure"
        root_cause: "Skipped pre-handover validation"
        prevention: "Always run actual CI scripts before handover"
      
      - incident: "PR #338 - Second Failure"  
        root_cause: "Added T0-014 but only updated 3 of 5 dependent files"
        affected_files:
          updated:
            - "governance/TIER_0_CANON_MANIFEST.json"
            - ".github/agents/ForemanApp-agent.md"
          not_updated:
            - ".agent (YAML configuration)"
            - "scripts/validate_tier0_activation.py"
            - ".github/workflows/tier0-activation-gate.yml"
        prevention: "Use consistency validator + follow checklist"
    
version: 2.0
---
