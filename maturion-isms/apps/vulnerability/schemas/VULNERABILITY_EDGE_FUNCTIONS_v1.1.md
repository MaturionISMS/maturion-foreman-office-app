Below is the full VULNERABILITY_EDGE_FUNCTIONS_v1.1.md, fully upgraded from v0.1 to the new Maturion engineering standard you established across WRAC, PIT, ERM, Threat, and RA.

This file is production-grade and follows:

True North Architecture v1.0

VULNERABILITY_DATABASE_SCHEMA_v1.1.md

SRMF pipeline flow

One-time build / zero regression

Standardised naming convention

Foreman/Co-Pilot alignment

Full lifecycle automation

Multi-module integration (Threat → UE → RA → WRAC → PIT → Remote Assurance → Intelligence)

Place in:
/Modules/Risk Management/VulnerabilityModule/VULNERABILITY_EDGE_FUNCTIONS_v1.1.md

VULNERABILITY_EDGE_FUNCTIONS_v1.1.md

Vulnerability Module — Backend / Edge Functions Specification
Version: 1.1
Aligned with:

VULNERABILITY_TRUE_NORTH_v1.0.md

VULNERABILITY_DATABASE_SCHEMA_v1.1.md

Threat Module Edge Functions v1.1

RA Engine v1.0

WRAC Edge Functions v1.1

PIT Edge Functions v1.1

Control Library v1.0

Remote Assurance Roadmap

0. PURPOSE

This document defines the full catalogue of backend logic, implemented as serverless Edge Functions, required for the operation of the Vulnerability Module.

Each function supports:

Vulnerability creation & lifecycle

Classification & severity assignment

Evidence ingestion

Threat–vulnerability relevance evaluation

UE generation

RA integration

WRAC integration

PIT integration

Watchdog & audit trails

AI-driven suggestions (non-destructive)

This is the reference used by Foreman & copilots to implement the backend.

1. NAMING CONVENTIONS
Prefix: vulnerability_
Scope: create / update / delete / evaluate / link / generate
Structure: vulnerability_<action>_<domain>
Examples:
  vulnerability_create_record
  vulnerability_evaluate_relevance
  vulnerability_generate_unwanted_event

2. FUNCTION CATEGORIES

The functions are organised into 11 categories:

1. Vulnerability Intake
2. Vulnerability Management
3. Severity & Classification
4. Evidence & Markup
5. Architecture Node Management
6. Threat–Vulnerability Linkage (TVRE)
7. UE (Unwanted Event) Generation
8. RA Integration
9. WRAC Integration
10. PIT Integration
11. Watchdog, Validation & Governance
12. AI Integration


We now define each category with full function details.

3. FUNCTION DEFINITIONS
3.1 VULNERABILITY INTAKE FUNCTIONS
vulnerability_create_record

Creates a new draft vulnerability.

Inputs:

company_id

title, description

category, subcategory

location_node_id

created_by

Logic:

Insert vulnerability with status = draft

Create version record v1

Initialize custodian assignment placeholder

Returns: vulnerability_id

vulnerability_clone_record

Creates a cloned draft from an approved vulnerability.

Inputs:

vulnerability_id

cloned_by

Logic:

Copy all fields (not evidence)

Set status = draft

Link parent_version_id

vulnerability_delete_draft

Allowed only for draft items.

3.2 VULNERABILITY MANAGEMENT FUNCTIONS
vulnerability_update_record

Updates fields only when status = draft.

vulnerability_submit_for_review

Moves draft → pending_approval.

Rules:

Custodian must exist

Severity must be populated

Must have location_node_id

Threat–vulnerability relevance must have been evaluated

vulnerability_approve_record

Custodian approval.

Logic:

Set status = approved

Create version snapshot

Trigger downstream:

UE regeneration

RA sync

WRAC sync

PIT check (critical vulnerabilities)

vulnerability_archive_record

Archives vulnerability.

Effects:

Removes UE associations

RA and WRAC entries marked inactive

PIT connections no longer active

3.3 SEVERITY & CLASSIFICATION FUNCTIONS
vulnerability_calculate_severity

Uses rule-based + AI weighting.

Inputs include:

evidence count

location criticality

exploitability_score

category weighting

asset impact values (via ERM)

Outputs:

severity_level (Low/Med/High/Critical)

severity_score (0–1)

vulnerability_set_severity

Manual override by custodian.

3.4 EVIDENCE & MARKUP FUNCTIONS
vulnerability_add_evidence

Uploads evidence file.

vulnerability_delete_evidence

Only allowed pre-approval.

vulnerability_add_markup

Adds markup metadata.

vulnerability_update_markup

AI or human rectification.

vulnerability_analyze_evidence_ai

AI reads uploaded image/PDF and proposes vulnerability overlays.

Outputs:

markup JSON

key regions

anomaly identification

AI suggestions are stored in vulnerability_ai_log.

3.5 ARCHITECTURE NODE MANAGEMENT FUNCTIONS

These functions mirror the risk structure builder from PIT & ERM, ensuring unified system consistency.

architecture_node_create
architecture_node_update
architecture_node_delete

(Deletion only allowed if unused.)

3.6 THREAT–VULNERABILITY RELEVANCE ENGINE (TVRE)
vulnerability_evaluate_threat_relevance

Core function powering UE pipeline.

Inputs:

vulnerability_id

threat_id

threat_version_id

Logic:

Pull TAP data

Pull TTP list

Evaluate facility/process relevance

Score exploitability

Validate threat–vulnerability compatibility

Check for nonsensical combos (auto-reject)

Outputs:

relevance_score

exploit_likelihood_modifier

valid (true/false)

reason

Stored in threat_vulnerability_link.

vulnerability_refresh_threat_links

Recompute relevance when:

Threat version updates

Vulnerability updated

Architecture node updated

New evidence uploaded

3.7 UNWANTED EVENT GENERATION
vulnerability_generate_unwanted_event

Executed when a link is valid.

Logic:

Use NLP template engine:
Threat exploiting Vulnerability at Location causes Unwanted Event

Validate grammar

Create UE record

vulnerability_rebuild_ue_for_vulnerability

Regenerates all UEs (e.g., after a severity or description change).

3.8 RA ENGINE INTEGRATION
vulnerability_push_to_ra

For each UE:

Create RA record

Link to vulnerability

Auto-fill likelihood contributor

Auto-fill impact baseline

Create mapping record

vulnerability_sync_ra_records

Used when:

UE changed

Severity changed

Threat relevance updated

New evidence added

Drift changed (threat side)

3.9 WRAC INTEGRATION
vulnerability_push_to_wrac

Creates WRAC row entries from RA records.

vulnerability_sync_wrac

When severity, location, UE, or controls change.

3.10 PIT INTEGRATION
vulnerability_flag_for_pit

When a vulnerability is:

Critical severity

Linked to high-risk threat

Missing controls

Marked as a Priority Unwanted Event (PUE) precursor

This creates a pending PIT item.

vulnerability_sync_pit

Synchronises PIT project statuses back into the vulnerability context:

% control implementation

Actual risk reduction

Remaining residual risk

3.11 WATCHDOG & GOVERNANCE FUNCTIONS
vulnerability_watchdog_run

Checks:

Orphaned UEs

Missing threat relevance evaluations

Invalid architecture nodes

Stuck workflows (pending >7 days)

Missing evidence for high severity

Wrong custodian roles

vulnerability_validate_before_publish

Mandatory final validation.

vulnerability_log_workflow_event

Stores all transitions.

vulnerability_log_ai_interaction

Captures AI suggestions from classification, severity, or evidence analysis.

3.12 AI INTEGRATION FUNCTIONS
vulnerability_ai_suggest_classification

Uses large model to propose vulnerability category/subcategory.

vulnerability_ai_suggest_severity

Suggests baseline severity score.

vulnerability_ai_suggest_description_polish

Produces a clear, structured vulnerability description.

vulnerability_ai_evidence_insight

AI interprets visual evidence.

vulnerability_ai_generate_ue_sentence

Uses NLG to draft well-formed UE sentences.

All AI outputs → staged until approved.

4. EVENT-BASED TRIGGERS
On vulnerability update:
    → reevaluate threat relevance

On evidence added:
    → AI suggestion (markup)
    → severity recalculation
    → threat relevance recalculation

On threat version update:
    → vulnerability_refresh_threat_links

On vulnerability approved:
    → generate UEs
    → push to RA
    → push to WRAC
    → PIT critical escalation check

5. CRON SCHEDULES
Every 10 min

Stuck workflows

Relevance pending recalculations

Nightly

Full threat–vulnerability recompute

RA sync

WRAC sync

PIT sync

Weekly

Full Watchdog scan

Evidence integrity check

6. PERFORMANCE TARGETS

Relevance calculation < 80 ms

UE generation < 120 ms

Evidence upload processing < 400 ms

Bulk nightly recompute ≤ 5 minutes per company

7. ACCEPTANCE CRITERIA (v1.1)

This backend layer is complete when:

All functions implemented

TVRE functioning deterministically

UE generation stable

RA & WRAC sync validated

PIT escalations working

Evidence engine stable

Watchdog rules operational

All flows pass QA

Foreman approves rollout

✔ END OF VULNERABILITY_EDGE_FUNCTIONS_v1.1.md