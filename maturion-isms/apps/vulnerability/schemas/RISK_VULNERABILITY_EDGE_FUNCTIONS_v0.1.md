# RISK_VULNERABILITY_EDGE_FUNCTIONS_v0.1  
**System:** Maturion ISMS  
**Module:** Vulnerability Management  
**Version:** v0.1  
**Status:** Architecture-Approved  
**Scope:** Serverless event-driven backend functions (Edge/API Routes) for the Vulnerability Module

---

# 0. PURPOSE OF THIS DOCUMENT

This document defines the **official backend event-driven function specifications** for the Vulnerability Module.

Edge Functions provide:

- Real-time updates  
- Immediate automation  
- Cross-module propagation (Threat, Risk, PIT, Incident)  
- AI-assisted workflows  
- Guaranteed consistency  
- Auditability + trace  
- Strict compliance with True North architecture  

Every backend engineer (human or AI) **must use ONLY these definitions**.

Any change requires:

1. Architecture Review  
2. QA Wiring Update  
3. Version bump to v0.2  

---

# 1. NAMING CONVENTIONS

All Edge Functions follow:

/api/vulnerability/<action>
/api/vulnerability/[id]/<action>

bash
Copy code

AI-related functions follow:

/api/vulnerability/ai/<action>

sql
Copy code

Cross-module propagation:

/api/vulnerability/<id>/propagate/<target>

yaml
Copy code

---

# 2. EDGE FUNCTION INDEX (MASTER LIST)

```text
2.1  createVulnerability
2.2  updateVulnerability
2.3  deleteVulnerability
2.4  changeStatus

3.1  addEvidence
3.2  deleteEvidence
3.3  classifyEvidenceAI

4.1  rateSeverity
4.2  proposeSeverityAI
4.3  approveSeverity

5.1  assignSteward
5.2  removeSteward
5.3  aiRecommendStewards

6.1  linkIncident
6.2  autoLinkIncidentAI
6.3  linkThreat
6.4  autoLinkThreatAI
6.5  linkPIT
6.6  autoCreatePITTaskAI

7.1  runAIAnalysis
7.2  suggestRisksAI
7.3  recalcVulnerabilitySeverityAI
7.4  detectMappingChangesAI

8.1  mapUpload
8.2  detectNodesAI
8.3  saveNode
8.4  deleteNode

9.1  auditLogWrite
9.2  notifyStewards
9.3  notifyRiskOwner
9.4  notifyEXCO
3. EDGE FUNCTION DEFINITIONS
Below are the full specifications.

2. CRUD OPERATIONS
2.1 /api/vulnerability/createVulnerability
Purpose
Create a new vulnerability record with default severity = null.

Input
json
Copy code
{
  "component_id": "UUID",
  "node_id": "UUID|null",
  "short_description": "string",
  "detailed_description": "string",
  "category": "enum",
  "discovery_mode": "enum",
  "created_by_user_id": "UUID"
}
Output
vulnerability_id

initial_status = "draft"

Triggers
Write to audit log

Notify Lead Steward(s)

AI auto-suggest threats (background)

2.2 /api/vulnerability/updateVulnerability
Update fields (description, category, node, etc.).

2.3 /api/vulnerability/deleteVulnerability
Marks a vulnerability as archived.

2.4 /api/vulnerability/[id]/changeStatus
Status transitions:

nginx
Copy code
draft → under_review → approved → archived
3. EVIDENCE FUNCTIONS
3.1 /api/vulnerability/[id]/addEvidence
Uploads and attaches evidence.

Input
File + metadata.

System Actions
Store file

Link evidence

AI categorisation (optional background call)

3.2 /api/vulnerability/[id]/deleteEvidence
Self-explanatory.

3.3 /api/vulnerability/evidence/classifyEvidenceAI
AI reads evidence and proposes:

Type

Relevance

Suggested severity impact

Threat correlation

4. SEVERITY FUNCTIONS
4.1 /api/vulnerability/[id]/rateSeverity
Stores a human-provided severity rating.

Input
json
Copy code
{
  "severity_value": 4,
  "rationale_text": "string",
  "lead_steward_id": "UUID"
}
Validation
If severity ≥ 4 → risk owner approval required.

4.2 /api/vulnerability/[id]/proposeSeverityAI
AI proposes severity based on:

NIST scoring

Evidence

Similar vulnerabilities

Threat links

Historical patterns

4.3 /api/vulnerability/[id]/approveSeverity
Final QA check before is_current = true.

5. STEWARD MANAGEMENT FUNCTIONS
5.1 /api/vulnerability/[id]/assignSteward
Adds a steward to vulnerability.

5.2 /api/vulnerability/[id]/removeSteward
Removes steward.

Check
Cannot remove the ONLY Lead Steward.

5.3 /api/vulnerability/ai/recommendStewards
Based on:

Required expertise (technical, process, behavioural, etc.)

Past involvement

Incident history

Similar vulnerability datasets

Outputs 3–7 recommended names.

6. CROSS-MODULE LINKS
6.1 /api/vulnerability/[id]/linkIncident
Manual linking.

6.2 /api/vulnerability/ai/autoLinkIncidentAI
Triggered whenever a new incident is logged:

AI checks:

Location

Description

Images

Controls involved

Keywords

If match ≥ threshold → auto-link.

6.3 /api/vulnerability/[id]/linkThreat
Manual linking.

6.4 /api/vulnerability/ai/autoLinkThreatAI
Triggered when:

Threat drift detected

New threat created

Threat description updated

AI matches vulnerability-to-threat relationships.

6.5 /api/vulnerability/[id]/linkPIT
Links vulnerability to PIT Task or Project.

6.6 /api/vulnerability/ai/autoCreatePITTaskAI
Triggered when:

Severity ≥ 4

Untreated vulnerability > 30 days

Control failure detected from Incident data

AI creates a PIT task:

json
Copy code
{
  "title": "Mitigate Vulnerability X",
  "description": "...",
  "priority": "High",
  "due_date": "auto"
}
7. AI ANALYSIS FUNCTIONS
7.1 /api/vulnerability/[id]/runAIAnalysis
Full AI analysis pipeline:

Severity check

Threat link scan

Similar vulnerabilities

Incident correlation

Pattern detection

Control gap analysis

7.2 /api/vulnerability/[id]/suggestRisksAI
AI proposes new risks based on:

Many-to-many threat → vulnerability logic

Bowtie logic

Control condition inferred from evidence

Behaviour data

7.3 /api/vulnerability/[id]/recalcVulnerabilitySeverityAI
Triggered by:

New incident

New evidence

Threat drift

EXCO environment alert

Control effectiveness drop

7.4 /api/vulnerability/[componentId]/detectMappingChangesAI
AI monitors:

New components/nodes uploaded

Flowchart changes

Facility layout changes

AI prompts stewards:

“Mapping changed. Revisit vulnerabilities at steps 4, 7, and 8.”

8. MAPPING FUNCTIONS
8.1 /api/component/[id]/mapUpload
Uploads base flowchart/image.

8.2 /api/component/[id]/detectNodesAI
AI identifies:

Steps

Process blocks

Bottlenecks

Junctions

Decision points

Outputs auto-suggested nodes.

8.3 /api/component/[id]/saveNode
Stores user-accepted nodes.

8.4 /api/component/[id]/deleteNode
Remove node.

9. SYSTEM & GOVERNANCE FUNCTIONS
9.1 /api/vulnerability/[id]/auditLogWrite
EVERY change triggers this.

9.2 /api/vulnerability/notifyStewards
Sends email + in-app notification.

9.3 /api/vulnerability/notifyRiskOwner
Called only when:

Severity ≥ 4

Control breakdowns

New AI risk suggestion

Escalation event

9.4 /api/vulnerability/notifyEXCO
For:

High-severity

Material risk exposure

Policy-impacting vulnerabilities

Financial impact > threshold

10. EVENT TRIGGER MATRIX
text
Copy code
EVENT: New Vulnerability Created
 → notifyStewards
 → runAIAnalysis (background)
 → autoLinkThreatAI

EVENT: Evidence Added
 → classifyEvidenceAI
 → recalcVulnerabilitySeverityAI

EVENT: Incident Logged
 → autoLinkIncidentAI
 → suggestRisksAI
 → recalcVulnerabilitySeverityAI

EVENT: Severity >= 4
 → notifyRiskOwner
 → autoCreatePITTaskAI

EVENT: Mapping Uploaded
 → detectNodesAI
 → detectMappingChangesAI
11. QA REQUIREMENTS (SUMMARY)
Every Edge Function must:

Have unit tests

Validate JSON schema

Write audit logs

Enforce RBAC

Handle missing fields cleanly

Never silently fail

Produce consistent error objects

Trigger downstream processes reliably

12. END OF DOCUMENT
RISK_VULNERABILITY_EDGE_FUNCTIONS_v0.1