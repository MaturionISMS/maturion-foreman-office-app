Below is the complete VULNERABILITY_DATABASE_SCHEMA_v1.1.md, fully upgraded from your v0.1 schema and aligned with:

VULNERABILITY_TRUE_NORTH_v1.0.md

Threat Module v1.1

RA Engine v1.0

WRAC v1.0

PIT v1.1

Control Library v1.0

Remote Assurance future integration

SRMF architecture

Zero Regression requirements

Maturion True North principles

This schema is production-grade, multi-model compatible, uses strict relational integrity, and is designed for pgvector, RLS, and serverless edge functions.

Place in:
/Modules/Risk Management/VulnerabilityModule/VULNERABILITY_DATABASE_SCHEMA_v1.1.md

VULNERABILITY_DATABASE_SCHEMA_v1.1.md

Vulnerability Module — Database Schema
Version: 1.1
Aligned with:

VULNERABILITY_TRUE_NORTH_v1.0.md

Threat Module DB v1.1

RA Engine DB v1.1

WRAC DB v1.1

PIT DB v1.1

Maturion ISMS Master Data Model

0. PURPOSE

This document defines the canonical database schema for the Vulnerability Module.
It replaces v0.1 and ensures:

complete vulnerability lifecycle tracking

clean architecture mapping

deterministic linkages to Threat, RA, WRAC, PIT

evidence & markup tracking

versioning & auditability

AI integration compatibility

extensibility for remote assurance

zero regression across the SRMF pipeline

This is the single source of truth for engineers and AI copilots.

1. HIGH-LEVEL ENTITY MAP
 Company
   └── Architecture Tree (nodes: zone → facility → process → lifecycle)
           └── Vulnerability
                   ├── Severity
                   ├── Evidence
                   ├── Markup
                   ├── Custodian Assignment
                   ├── Threat–Vulnerability Links
                   │         └── Unwanted Events (UE)
                   ├── Versioning
                   └── Audit Log

2. CORE TABLES
2.1 vulnerability

Stores the base vulnerability record.

Field	Type	Description
id	uuid (PK)	Unique vulnerability ID
company_id	uuid (FK)	Organisation owning the record
title	text	Short structured vulnerability name
description	text	Detailed description
category	text	Vulnerability category (NIST/ISO)
subcategory	text	Optional refinement
location_node_id	uuid (FK)	Where in the architecture it exists
severity_level	text	Low/Medium/High/Critical
severity_score	numeric	AI + human approved normalized score (0–1)
exploitability_score	numeric	Derived from threat relevance (0–1)
status	text	draft/pending/approved/archived
created_by	uuid (FK)	User who created the record
approved_by	uuid (FK)	Custodian approving
created_at	timestamptz	Timestamp
updated_at	timestamptz	Timestamp
published_at	timestamptz	First approval timestamp
parent_version_id	uuid (FK nullable)	If cloned from another vulnerability

Indexes:

idx_vuln_company_id

idx_vuln_location_node

idx_vuln_status

idx_vuln_severity

3. VERSIONING TABLES
3.1 vulnerability_version

Immutable version snapshots.

Field	Type	Description
id	uuid (PK)	
vulnerability_id	uuid (FK)	
version_number	integer	Incremental
title	text	
description	text	
category	text	
subcategory	text	
location_node_id	uuid (FK)	
severity_level	text	
severity_score	numeric	
exploitability_score	numeric	
changelog	jsonb	What changed
created_by	uuid	
created_at	timestamptz	
4. ARCHITECTURE MAPPING TABLES
4.1 architecture_node

Represents ANY node in the process–lifecycle–facility–zone tree.

Field	Type	Description
id	uuid (PK)	
company_id	uuid (FK)	
name	text	
description	text	
type	text	zone/facility/process/lifecycle/custom
parent_id	uuid (FK self)	
order_index	integer	UI ordering
created_by	uuid	
created_at	timestamptz	

Indexes:

idx_architecture_node_company

idx_architecture_node_parent

5. EVIDENCE & MARKUP TABLES
5.1 vulnerability_evidence
Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
file_url	text
file_type	text
description	text
uploaded_by	uuid
uploaded_at	timestamptz
5.2 vulnerability_markup
Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
evidence_id	uuid (FK)
markup_data	jsonb
ai_generated	boolean
created_by	uuid
created_at	timestamptz
6. CUSTODIAN & GOVERNANCE TABLES
6.1 vulnerability_custodian
Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
user_id	uuid (FK)
assigned_at	timestamptz
role	text
6.2 vulnerability_workflow_event

Tracks every workflow transition.

Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
status_from	text
status_to	text
action_by	uuid
action_at	timestamptz
comment	text
7. THREAT–VULNERABILITY LINKAGE TABLES
7.1 threat_vulnerability_link

Links valid threat–vulnerability relationships.

Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
threat_id	uuid (FK)
threat_version_id	uuid (FK)
relevance_score	numeric (0–1)
exploit_likelihood_modifier	numeric (0–1)
valid	boolean
reason	text
evaluated_at	timestamptz
evaluated_by	uuid (FK or null if AI)
ai_suggestion	boolean

Indexes:

idx_link_vulnerability

idx_link_threat

idx_link_valid

8. UNWANTED EVENT GENERATION TABLES
8.1 unwanted_event

Created only for valid threat–vulnerability links.

Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
threat_id	uuid (FK)
threat_version_id	uuid (FK)
ue_title	text
ue_sentence	text
auto_generated	boolean
validated_by	uuid
validated_at	timestamptz
9. INTEGRATION TABLES
9.1 vulnerability_to_ra

Links vulnerability outputs into RA Engine.

Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
ue_id	uuid (FK)
ra_record_id	uuid (FK RA table)
created_at	timestamptz
9.2 vulnerability_to_wrac
Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK)
wrac_row_id	uuid
created_at	timestamptz
10. AI INTEGRATION TABLES
10.1 vulnerability_ai_log

Stores all AI interactions & suggestions.

Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK nullable)
model_name	text
model_version	text
input_hash	text
output_hash	text
suggestion	jsonb
confidence	numeric
accepted_by_user	boolean
created_by	uuid
created_at	timestamptz
11. WATCHDOG SUPPORT TABLES
11.1 vulnerability_watchdog_event
Field	Type
id	uuid (PK)
vulnerability_id	uuid (FK nullable)
event_type	text
severity	text
message	text
details	jsonb
triggered_at	timestamptz
resolved	boolean
resolved_by	uuid (nullable)
resolved_at	timestamptz (nullable)
12. FOREIGN KEY INTEGRITY MAP
Vulnerability ties into:

Threat Module → threat / threat_version

RA Engine → ra_record

WRAC → wrac_row

PIT → pit_project via control/mitigation mapping

Control Library → for recommended controls

Remote Assurance → control performance

Strict FK cascades:

ON DELETE RESTRICT (no silent deletions)
ON UPDATE CASCADE (version-safe)

13. SECURITY & RLS (Row-Level Security)

RLS rules:

Analysts can create & edit drafts

Custodians can approve & publish

Managers can archive

Reviewers can comment but not edit

Other employees: read-only to approved items

Cross-company isolation enforced strictly

14. PERFORMANCE REQUIREMENTS

All link lookups < 80 ms

UE generation list < 100 ms

Evidence load < 250 ms

Architecture tree queries < 150 ms

TTP/Threat relevance queries < 120 ms

All tables indexed for:

company_id

status

threat_id

vulnerability_id

created_at

15. VALIDATION & QA GUARDRAILS

Vulnerability cannot be published unless:

severity_level set

severity_score set

location_node valid

custodian assigned

AI suggestions accepted/rejected

threat-vulnerability relevance evaluated

16. ACCEPTANCE CRITERIA (v1.1)

The schema is accepted as v1.1 when:

All above tables created

All indexes applied

All FK relationships confirmed

All RLS policies tested

Threat, RA, WRAC, PIT integrations verified

Evidence upload & markup validated

Watchdog events integrated

Foreman sign-off completed

✔ END OF VULNERABILITY_DATABASE_SCHEMA_v1.1.md