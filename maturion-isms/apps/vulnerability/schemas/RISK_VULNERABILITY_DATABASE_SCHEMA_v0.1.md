# RISK_VULNERABILITY_DATABASE_SCHEMA_v0.1  
**System:** Maturion ISMS  
**Module:** Vulnerability Management  
**Version:** v0.1  
**Status:** Approved (Architecture-Aligned)  
**Scope:** Full relational schema for backend implementation

---

# 0. PURPOSE OF THIS DOCUMENT

This document defines the **canonical database schema** for the Vulnerability Module.  
It ensures:

- 100% alignment with the True North Architecture  
- No legacy fields  
- No ambiguity  
- Full integration with:  
  - Threat Module  
  - Risk Module  
  - PIT  
  - Incident Management  
  - Remote Assurance  
- Foreman QA operability  
- Future scalability (v0.2+)

All backend builders must use **this schema only**.  
Any deviations must trigger:
- Architecture Review  
- QA wiring update  
- Version bump  

---

# 1. OVERALL ENTITY DIAGRAM (TEXT-BASED ERD)

```text
+--------------------------+        +---------------------+
| architecture_component   |1      M| component_node      |
+--------------------------+--------+---------------------+
              |1                                  |M
              |                                   |
              |                                   |
              |1                                 M|
+--------------------------+       +------------------------+
| vulnerability            |1-----M| vulnerability_evidence |
+--------------------------+       +------------------------+
       |1           |M
       |            |
       |            |M
       |            |
       |1          M|
+-----------------------------+
| vulnerability_severity      |
+-----------------------------+

+-------------------------------------+
| vulnerability_steward_assignment    |
+-------------------------------------+

+----------------------------------+
| vulnerability_threat_link        |
+----------------------------------+

+----------------------------------+
| vulnerability_pit_link           |
+----------------------------------+

+----------------------------------+
| vulnerability_incident_link      |
+----------------------------------+

+----------------------------------+
| vulnerability_audit_log          |
+----------------------------------+
2. SCHEMA DEFINITIONS
Below is the exhaustive table-by-table specification.

2.1 architecture_component
Represents the process, lifecycle or facility within the business environment.

Field	Type	Description
id	UUID PK	Unique identifier
org_id	UUID FK	Organisation
site_id	UUID FK	Site / Operation
type	ENUM(process, lifecycle, facility)	Component category
name	TEXT	Component name
description	TEXT	Purpose/summary
owner_user_id	UUID FK	Person responsible (Lead Steward x Risk Owner relationship optional here)
base_artifacts	JSONB	List of uploaded files (flowcharts, images, diagrams, CAD, etc.)
status	ENUM(draft, active, archived)	Current lifecycle state
created_at	TIMESTAMP	
updated_at	TIMESTAMP	

2.2 component_node
Represents a step, location, stage, or interface in an architecture component.

Field	Type	Description
id	UUID PK	
component_id	UUID FK → architecture_component.id	
name	TEXT	Node name
description	TEXT	Optional
order_index	INT	Order in process/lifecycle
coordinates	JSONB	Suggested: {x:0.1,y:0.22} for map overlay pin positions
created_at	TIMESTAMP	
updated_at	TIMESTAMP	

2.3 vulnerability
Primary record representing a vulnerability.

Field	Type	Description
id	UUID PK	
component_id	UUID FK → architecture_component.id	
node_id	UUID FK → component_node.id (nullable if not linked to a specific step)	
short_description	TEXT	Main summary
detailed_description	TEXT	Full narrative
category	ENUM(process, technology, people, environment, information, physical, behavioural, control,other)	
discovery_mode	ENUM(desktop, walkthrough, incident, ai_suggested)	
created_by_user_id	UUID FK	
lead_steward_user_id	UUID FK	
risk_owner_user_id	UUID FK	
status	ENUM(draft, under_review, approved, archived)	
ai_generated	BOOLEAN	True if initially created by AI
ai_confidence	DECIMAL(0,2)	0.00 - 1.00 only if AI-generated
created_at	TIMESTAMP	
updated_at	TIMESTAMP	

2.4 vulnerability_evidence
Every piece of evidence attached to a vulnerability.

Field	Type	Description
id	UUID PK	
vulnerability_id	UUID FK	
evidence_type	ENUM(photo, video, document, diagram, map, 3d_model, incident_reference)	
file_id	UUID FK (nullable when evidence is not a file but text or incident ref)	
description	TEXT	Explanation of evidence
uploaded_by_user_id	UUID FK	
created_at	TIMESTAMP	

2.5 vulnerability_severity
Represents the current and historical severity ratings.

Field	Type	Description
id	UUID PK	
vulnerability_id	UUID FK	
severity_value	INT CHECK 1–5	
severity_label	ENUM(Insignificant,Minor,Moderate,High,Major)	
rationale_text	TEXT	Human explanation
ai_explanation	TEXT	AI justification if AI proposed
suggested_by_ai	BOOLEAN	
lead_steward_user_id	UUID FK	
risk_owner_approved	BOOLEAN	
risk_owner_user_id	UUID FK (nullable when not required)	
is_current	BOOLEAN	Only ONE record per vulnerability = TRUE
created_at	TIMESTAMP	

Constraint:

A trigger ensures only one is_current = TRUE per vulnerability.

2.6 vulnerability_steward_assignment
Defines the full Steward Team + Lead Steward flag.

Field	Type	Description
id	UUID PK	
vulnerability_id	UUID FK	
user_id	UUID FK	
role	ENUM(steward,lead_steward,risk_owner)	
created_at	TIMESTAMP	

Note: Lead Steward is also stored in vulnerability, but duplicated here for team consistency.

2.7 vulnerability_threat_link
Defines many-to-many link between Vulnerabilities and Threats.

Field	Type	Description
id	UUID PK	
vulnerability_id	UUID FK	
threat_id	UUID FK → threat.id	
ai_suggested	BOOLEAN	
rationale_text	TEXT	
created_at	TIMESTAMP	

2.8 vulnerability_incident_link
Links vulnerabilities to the Incident Module.

Field	Type	Description
id	UUID PK	
vulnerability_id	UUID FK	
incident_id	UUID FK	
ai_flagged	BOOLEAN	
linked_by_user_id	UUID FK	
created_at	TIMESTAMP	

2.9 vulnerability_pit_link
Links vulnerabilities to PIT tasks or projects.

Field	Type	Description
id	UUID PK	
vulnerability_id	UUID FK	
pit_item_id	UUID FK → pit_task or pit_project	
link_type	ENUM(task,project)	
ai_suggested	BOOLEAN	
created_at	TIMESTAMP	

2.10 vulnerability_audit_log
Full traceability for every operation.

Field	Type	Description
id	UUID PK	
vulnerability_id	UUID FK	
action_type	ENUM(created,updated,severity_changed,evidence_added,linked_to_incident,linked_to_threat,linked_to_pit,status_changed,ai_recommendation,team_assigned)	
old_value	JSONB	
new_value	JSONB	
actor_user_id	UUID FK (nullable when AI)	
is_ai	BOOLEAN	
created_at	TIMESTAMP	

3. INTEGRITY CONSTRAINTS
3.1 Severity Integrity
A vulnerability MUST have:

Exactly one current severity (is_current = TRUE)

A severity rating of 4 or 5 MUST have:

risk_owner_approved = TRUE

3.2 Mapping Integrity
A vulnerability MUST belong to an architecture_component.

A component_node MUST belong to an architecture_component.

3.3 Steward Integrity
Every vulnerability MUST have at least:

One Lead Steward

One Risk Owner

One Steward

3.4 Evidence Integrity
A vulnerability cannot move to “approved” unless:

At least one evidence record is attached, or

evidence_override_reason exists (added to v0.2)

4. INDEXING STRATEGY
Recommended:
INDEX vulnerability_component_idx (component_id)

INDEX vulnerability_node_idx (node_id)

INDEX evidence_vulnerability_idx (vulnerability_id)

INDEX severity_current_idx (vulnerability_id, is_current)

GIN INDEX on JSONB fields:

base_artifacts

old_value

new_value

Full-text search:

short_description

detailed_description

rationale_text

5. RELATIONSHIP RULES
5.1 Vulnerability Lifecycle Rules
text
Copy code
draft → under_review → approved → archived
Transitions:
From	To	Allowed By
draft	under_review	Lead Steward
under_review	approved	Lead Steward + Risk Owner (if severity ≥4)
approved	archived	Risk Owner
archived	approved	NOT allowed (must duplicate and create new version)

6. AI INTEGRATION FIELDS
Included fields:
ai_generated

ai_confidence

ai_explanation

suggested_by_ai

ai_suggested (links)

AI triggers stored as actions in audit log.
7. FUTURE v0.2+ EXTENSIONS
Digital Twin Integration

Sensor & IoT-based vulnerability discovery

Exposure scoring model

Automated photographic risk pattern detection

Risk monetisation fields (ROI calculations)

8. END OF DOCUMENT
RISK_VULNERABILITY_DATABASE_SCHEMA_v0.1

yaml
Copy code
