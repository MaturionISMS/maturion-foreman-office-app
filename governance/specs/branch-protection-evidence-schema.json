{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Branch Protection Verification Evidence",
  "description": "Schema for branch protection verification evidence. Compatible with canonical governance schemas.",
  "type": "object",
  "required": [
    "verification_timestamp",
    "verification_method",
    "repository",
    "branches_verified",
    "overall_status",
    "canonical_governance_reference"
  ],
  "properties": {
    "verification_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of verification"
    },
    "verification_method": {
      "type": "string",
      "enum": ["API", "CLI", "INSPECTION"],
      "description": "Method used to verify branch protection"
    },
    "repository": {
      "type": "string",
      "pattern": "^[^/]+/[^/]+$",
      "description": "Repository in owner/repo format"
    },
    "branches_verified": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "branch_name",
          "protection_enabled",
          "compliance_status"
        ],
        "properties": {
          "branch_name": {
            "type": "string",
            "description": "Name of the branch"
          },
          "protection_enabled": {
            "type": "boolean",
            "description": "Whether branch protection is enabled"
          },
          "required_status_checks": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of required status checks"
          },
          "required_approvals": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of required approvals"
          },
          "administrator_enforcement": {
            "type": "boolean",
            "description": "Whether administrators are subject to rules"
          },
          "force_push_blocked": {
            "type": "boolean",
            "description": "Whether force pushes are blocked"
          },
          "deletion_blocked": {
            "type": "boolean",
            "description": "Whether branch deletion is blocked"
          },
          "linear_history": {
            "type": "boolean",
            "description": "Whether linear history is enforced"
          },
          "compliance_status": {
            "type": "string",
            "enum": ["COMPLIANT", "NON_COMPLIANT"],
            "description": "Compliance status for this branch"
          },
          "deviations": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["requirement", "expected", "actual", "severity"],
              "properties": {
                "requirement": {
                  "type": "string",
                  "description": "Name of requirement that deviated"
                },
                "expected": {
                  "type": "string",
                  "description": "Expected value"
                },
                "actual": {
                  "type": "string",
                  "description": "Actual value"
                },
                "severity": {
                  "type": "string",
                  "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
                  "description": "Severity of deviation"
                }
              }
            },
            "description": "List of deviations from expected configuration"
          }
        }
      },
      "description": "Array of branch verification results"
    },
    "overall_status": {
      "type": "string",
      "enum": ["GREEN", "AMBER", "RED"],
      "description": "Overall compliance status across all branches"
    },
    "canonical_governance_reference": {
      "type": "string",
      "description": "Reference to canonical governance (e.g., repo#PR-number)"
    },
    "bootstrap_exception": {
      "type": "boolean",
      "description": "Whether a bootstrap exception is in effect"
    },
    "bootstrap_exception_details": {
      "type": ["object", "null"],
      "properties": {
        "reason": {
          "type": "string",
          "description": "Reason for bootstrap exception"
        },
        "authorized_by": {
          "type": "string",
          "description": "Who authorized the exception"
        },
        "authorization_date": {
          "type": "string",
          "format": "date-time",
          "description": "When exception was authorized"
        },
        "expiry_date": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "When exception expires (null if no expiry)"
        },
        "resolution_plan": {
          "type": "string",
          "description": "Plan to resolve and remove exception"
        }
      },
      "required": ["reason", "authorized_by", "authorization_date", "resolution_plan"],
      "description": "Details of bootstrap exception if applicable"
    }
  },
  "additionalProperties": false
}
